<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSE Gruppe 10 Webserver: src/request.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PSE Gruppe 10 Webserver
   </div>
   <div id="projectbrief">A simple HTTP 1.0/1.1 webserver written in C11</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">request.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>All functions needed for parsing and processing an incoming http request.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="auth_8h_source.html">auth.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="header_8h_source.html">header.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mime_8h_source.html">mime.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="request__struct_8h_source.html">request_struct.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="response__struct_8h_source.html">response_struct.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tables_8h_source.html">tables.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utils_8h_source.html">utils.h</a>&quot;</code><br />
</div>
<p><a href="request_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a6b20d41d6252e9871430c242cb1a56e7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="request_8h.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>&#160;&#160;&#160;8192</td></tr>
<tr class="memdesc:a6b20d41d6252e9871430c242cb1a56e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">default buffer size  <a href="#a6b20d41d6252e9871430c242cb1a56e7">More...</a><br /></td></tr>
<tr class="separator:a6b20d41d6252e9871430c242cb1a56e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd0ce4a3f1d8724bc00a48406afeccf1"><td class="memItemLeft" align="right" valign="top"><a id="afd0ce4a3f1d8724bc00a48406afeccf1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="request_8h.html#afd0ce4a3f1d8724bc00a48406afeccf1">HEADER_VALUE_SIZE</a>&#160;&#160;&#160;64</td></tr>
<tr class="memdesc:afd0ce4a3f1d8724bc00a48406afeccf1"><td class="mdescLeft">&#160;</td><td class="mdescRight">the default size for a http header (we decided to use this specific value, as it turned out to fit very well) <br /></td></tr>
<tr class="separator:afd0ce4a3f1d8724bc00a48406afeccf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae5f780eff2ea6487ce2ffc516d37d4de"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="request_8h.html#ae5f780eff2ea6487ce2ffc516d37d4de">parse_request</a> (char *, <a class="el" href="structrequest__header.html">request_header</a> *, <a class="el" href="structhttp__response.html">http_response</a> *)</td></tr>
<tr class="separator:ae5f780eff2ea6487ce2ffc516d37d4de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17335c1f56778bbe371b835492cc2cb7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="request_8h.html#a17335c1f56778bbe371b835492cc2cb7">allocate_header</a> (<a class="el" href="structrequest__header.html">request_header</a> *)</td></tr>
<tr class="memdesc:a17335c1f56778bbe371b835492cc2cb7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates all memory needed to store information regarding the incoming request.  <a href="#a17335c1f56778bbe371b835492cc2cb7">More...</a><br /></td></tr>
<tr class="separator:a17335c1f56778bbe371b835492cc2cb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fd2b371e007430ed3981940baa61be7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="request_8h.html#a3fd2b371e007430ed3981940baa61be7">free_header</a> (<a class="el" href="structrequest__header.html">request_header</a> *)</td></tr>
<tr class="memdesc:a3fd2b371e007430ed3981940baa61be7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees memory we allocated using allocate_header.  <a href="#a3fd2b371e007430ed3981940baa61be7">More...</a><br /></td></tr>
<tr class="separator:a3fd2b371e007430ed3981940baa61be7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84b56339605ee0eb6cc220f1bb522ac2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="request_8h.html#a84b56339605ee0eb6cc220f1bb522ac2">validate_request</a> (<a class="el" href="structrequest__header.html">request_header</a> *, <a class="el" href="structhttp__response.html">http_response</a> *)</td></tr>
<tr class="memdesc:a84b56339605ee0eb6cc220f1bb522ac2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the request is valid (method, host, content-length, authorization, and some more)  <a href="#a84b56339605ee0eb6cc220f1bb522ac2">More...</a><br /></td></tr>
<tr class="separator:a84b56339605ee0eb6cc220f1bb522ac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc3edc8f0d6bab2038c5a2f2e2f7d240"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="request_8h.html#acc3edc8f0d6bab2038c5a2f2e2f7d240">build_absolute_path</a> (<a class="el" href="structrequest__header.html">request_header</a> *, <a class="el" href="structhttp__response.html">http_response</a> *, const char *)</td></tr>
<tr class="memdesc:acc3edc8f0d6bab2038c5a2f2e2f7d240"><td class="mdescLeft">&#160;</td><td class="mdescRight">Takes the parsed requested resource and generates an internally processable resource path (if valid)  <a href="#acc3edc8f0d6bab2038c5a2f2e2f7d240">More...</a><br /></td></tr>
<tr class="separator:acc3edc8f0d6bab2038c5a2f2e2f7d240"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>All functions needed for parsing and processing an incoming http request. </p>
<dl class="section author"><dt>Author</dt><dd>PSE Gruppe 10 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>SoSe 2017 </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a6b20d41d6252e9871430c242cb1a56e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b20d41d6252e9871430c242cb1a56e7">&#9670;&nbsp;</a></span>BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUFFER_SIZE&#160;&#160;&#160;8192</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>default buffer size </p>
<p>This is set to 8192, because this also is the default value in the well known apache2 webserver </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a17335c1f56778bbe371b835492cc2cb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17335c1f56778bbe371b835492cc2cb7">&#9670;&nbsp;</a></span>allocate_header()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool allocate_header </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrequest__header.html">request_header</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates all memory needed to store information regarding the incoming request. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">response</td><td>response header which is allocated </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the allocation was successful, false otherwise </dd></dl>

</div>
</div>
<a id="acc3edc8f0d6bab2038c5a2f2e2f7d240"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc3edc8f0d6bab2038c5a2f2e2f7d240">&#9670;&nbsp;</a></span>build_absolute_path()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void build_absolute_path </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrequest__header.html">request_header</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structhttp__response.html">http_response</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Takes the parsed requested resource and generates an internally processable resource path (if valid) </p>
<p>Takes the parsed requested resource and checks if:</p><ul>
<li>it is within the directory root (making use of realpath i.e.)</li>
<li>it is within the RFC boundaries (URI length)</li>
<li>it is a directory and the request actually wants to see the index.html file</li>
<li>it's within it's area (intern should only access internal content, extern only external)</li>
</ul>
<p>Responds with an http error response, otherwise sets the correct resource_path in the response struct</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">request_reader</td><td>the request struct with all information gathered from the request </td></tr>
    <tr><td class="paramname">response</td><td>the response struct used for either errors or the resulting resource path </td></tr>
    <tr><td class="paramname">vhost</td><td>the accessed vhost (it is appended to the resource path</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="structhttp__response.html" title="struct for responses with buffer for header body ">http_response</a> </dd></dl>

</div>
</div>
<a id="a3fd2b371e007430ed3981940baa61be7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fd2b371e007430ed3981940baa61be7">&#9670;&nbsp;</a></span>free_header()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_header </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrequest__header.html">request_header</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees memory we allocated using allocate_header. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">header</td><td>a pointer to the header we are about to free </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="request_8h.html#a17335c1f56778bbe371b835492cc2cb7" title="Allocates all memory needed to store information regarding the incoming request. ">allocate_header</a> </dd></dl>

</div>
</div>
<a id="ae5f780eff2ea6487ce2ffc516d37d4de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5f780eff2ea6487ce2ffc516d37d4de">&#9670;&nbsp;</a></span>parse_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void parse_request </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrequest__header.html">request_header</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structhttp__response.html">http_response</a> *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Parses an incoming request and does a many sanity checks (see RCF HTTP 1.0/1.1) The method itself directly throws http errors in case something does not fulfill standards or is badly formed Headed which are valid and not supported are ignored All detected Headers are stored in a struct</p>
<p>Further information on all the checks can be found before each snippet in this method</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer_in</td><td>the input buffer taken from the socket </td></tr>
    <tr><td class="paramname">req_header</td><td>The (publicly available) object that will hold all request-related information </td></tr>
    <tr><td class="paramname">response</td><td>The (publicly available) object that's reserved to hold the outgoing response </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://tools.ietf.org/html/rfc1945">https://tools.ietf.org/html/rfc1945</a> </dd>
<dd>
<a href="https://tools.ietf.org/html/rfc7230">https://tools.ietf.org/html/rfc7230</a> </dd></dl>

</div>
</div>
<a id="a84b56339605ee0eb6cc220f1bb522ac2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84b56339605ee0eb6cc220f1bb522ac2">&#9670;&nbsp;</a></span>validate_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void validate_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrequest__header.html">request_header</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structhttp__response.html">http_response</a> *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the request is valid (method, host, content-length, authorization, and some more) </p>
<ul>
<li>checks if there's an host provided</li>
<li>checks if the http method is GET (we currently support no other method)</li>
<li>if the requested host is intern, checks if there's the required authorization header (otherwise requests authorization)</li>
<li>checks if the content length header's value is a valid integer</li>
<li>checks if there is a %-char as it is not allowed after decoding the url</li>
</ul>
<p>Calls <code>build_absolute_path</code> when everything went well</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">header</td><td>the header we just filled with information during parse_request </td></tr>
    <tr><td class="paramname">response</td><td>a pointer to the struct we want to store the response information in </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="request_8h.html#ae5f780eff2ea6487ce2ffc516d37d4de">parse_request</a> </dd>
<dd>
<a class="el" href="request_8h.html#acc3edc8f0d6bab2038c5a2f2e2f7d240" title="Takes the parsed requested resource and generates an internally processable resource path (if valid) ...">build_absolute_path</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
